name: Benchmark Push

permissions:
  contents: read
  pull-requests: write
on:
  pull_request:
    types: [ opened, synchronize, reopened, labeled ]
jobs:
    benchmark:
        runs-on: ubuntu-latest
        steps:
        - uses: actions/checkout@v4
          with:
            submodules: true
        - name: Setup Actions User
          run: |
                git config user.name github-actions[bot]
                git config user.email 41898282+github-actions[bot]@users.noreply.github.com
                git fetch
        - uses: actions-rust-lang/setup-rust-toolchain@v1
        - name: Checkout And Copy Benchmarks
          run: |
            git checkout -b benchmarks-result
            cp -r target/criterion benchmarks-result/
        - name: Checkout Current Branch
          run: |
            git checkout -
            cp -r benchmarks-result/target/criterion target/
        # Run benchmark but write to file
        - name: Compare Benchmark Results
          run: bash ${GITHUB_WORKSPACE}/__bin__/bench_template.sh  /target/comment.txt
        # Upload Results by commenting ON PR
        - name: Upload Results
          run: |
            gh pr comment ${{ github.event.pull_request.number }} --body-file /target/comment.txt